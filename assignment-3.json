{"paragraphs":[{"text":"%pyspark\nfrom pyspark.sql import functions as F\nfrom pyspark.sql.types import IntegerType","user":"anonymous","dateUpdated":"2018-08-22T01:27:14+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1534897222736_594812962","id":"20180822-002022_237442704","dateCreated":"2018-08-22T00:20:22+0000","dateStarted":"2018-08-22T01:27:14+0000","dateFinished":"2018-08-22T01:27:14+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:7033"},{"text":"%pyspark\n\nclient_orders = spark.read.json(\"gs://de-training-input/alimazon/50000/client-orders\")","user":"anonymous","dateUpdated":"2018-08-21T23:33:00+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1534893758092_-1394977828","id":"20180821-232238_197555793","dateCreated":"2018-08-21T23:22:38+0000","dateStarted":"2018-08-21T23:33:00+0000","dateFinished":"2018-08-21T23:33:02+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7034"},{"text":"%pyspark\nclient_orders.show()","user":"anonymous","dateUpdated":"2018-08-21T23:33:11+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+--------------------+----------+--------+--------------------+-------+\n|           client_id|                  id|product_id|quantity|           timestamp|  total|\n+--------------------+--------------------+----------+--------+--------------------+-------+\n|a2f47a6a-00d1-43c...|e8b3f969-8494-474...|0615657060|      19|2018-04-20T14:17:...|2124.01|\n|a2f47a6a-00d1-43c...|08ffc362-b8cd-473...|B0089KFGBQ|      72|2018-04-23T14:17:...|6732.72|\n|a2f47a6a-00d1-43c...|1140072e-a5e2-401...|B00AFBWF84|      80|2018-04-29T14:17:...| 1977.6|\n|a2f47a6a-00d1-43c...|2cf08e8c-4b19-487...|B001LGI01I|      94|2018-05-02T14:17:...|2207.12|\n|a2f47a6a-00d1-43c...|c0497fbe-3076-48a...|B00SSY01L8|      16|2018-05-05T14:17:...|   93.6|\n|a2f47a6a-00d1-43c...|e084e05e-8997-4c5...|B001J5ZLCM|      33|2018-05-08T14:17:...| 389.07|\n|a2f47a6a-00d1-43c...|7173d567-88cf-4a0...|B00C9LF7UG|      58|2018-05-14T14:17:...|6992.48|\n|a2f47a6a-00d1-43c...|b5b65701-66cd-44c...|B0015KTXBQ|      56|2018-05-17T14:17:...| 1145.2|\n|a2f47a6a-00d1-43c...|22281753-c333-49d...|B001P6ENOW|      77|2018-05-20T14:17:...|6548.85|\n|a2f47a6a-00d1-43c...|1e01740b-ee95-402...|B00TYJE20M|      53|2018-05-26T14:17:...|1090.21|\n|a2f47a6a-00d1-43c...|fb42259e-fd06-4b1...|B007C4PQ1K|      30|2018-05-29T14:17:...|  632.4|\n|93b55e61-e23b-44b...|b223f226-25e1-4a0...|B00851GOAG|      94|2018-05-07T18:43:...|5396.54|\n|93b55e61-e23b-44b...|29e0e705-82a3-4c8...|B00KHKW6DC|      11|2018-05-10T18:43:...|  625.9|\n|93b55e61-e23b-44b...|626b0fff-f313-416...|B004QOPSKI|      64|2018-05-13T18:43:...|5772.16|\n|93b55e61-e23b-44b...|d79b2455-140e-4f5...|B000OA6FMS|      10|2018-05-16T18:43:...|  215.7|\n|93b55e61-e23b-44b...|8d029d65-d3de-4e5...|B001TKZ2MG|      89|2018-05-19T18:43:...| 541.12|\n|93b55e61-e23b-44b...|ea4ffb51-f447-49c...|B008YJURTI|       6|2018-05-22T18:43:...|  242.1|\n|93b55e61-e23b-44b...|33eae548-3c8d-4ca...|B004T8YXOS|      20|2018-05-28T18:43:...|  190.4|\n|93b55e61-e23b-44b...|c0c5ce4b-4397-45e...|1291653457|      23|2018-05-31T18:43:...| 178.02|\n|128ea102-b935-4a3...|f6a75cc2-e429-49d...|B00A4C5CUC|      38|2018-05-02T16:19:...|  858.8|\n+--------------------+--------------------+----------+--------+--------------------+-------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1534893770558_-640839335","id":"20180821-232250_1812464241","dateCreated":"2018-08-21T23:22:50+0000","dateStarted":"2018-08-21T23:33:11+0000","dateFinished":"2018-08-21T23:33:11+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7035"},{"text":"%pyspark\nfrom datetime import datetime\n\ndef toWeekday(timestamp):\n    return datetime.strptime(timestamp, \"%Y-%m-%dT%H:%M:%S.%f\").weekday()\n    \nudf_toWeekday = F.udf(toWeekday, IntegerType())\n\nclient_orders \\\n    .select('product_id', 'total', 'timestamp').withColumn('weekday', F.lit(udf_toWeekday(client_orders.timestamp))).alias(\"orderWeekdays\") \\\n    .filter(F.col('orderWeekdays.weekday') == 4).alias('order_4') \\\n    .groupBy(F.col('order_4.product_id')) \\\n    .agg(F.sum(\"order_4.total\").alias('gross-sales')) \\\n    .orderBy('gross-sales', ascending=False) \\\n    .show(10)\n\n\n","user":"anonymous","dateUpdated":"2018-08-22T02:07:30+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+-----------+\n|product_id|gross-sales|\n+----------+-----------+\n|B00K15Y56Y|   61049.85|\n|B00C7KTJFS|    31404.1|\n|B00BEH11CY|   30048.35|\n|B00HKL7ZM8|   29637.16|\n|B00XZ088YC|   29449.68|\n|B00G6NZST8|    29201.9|\n|B003VKXWT2|    28908.0|\n|B007L9AXJ6|   27356.91|\n|1401603858|   26983.24|\n|0727861905|    26926.8|\n+----------+-----------+\nonly showing top 10 rows\n\n"}]},"apps":[],"jobName":"paragraph_1534894368067_-302573888","id":"20180821-233248_243967055","dateCreated":"2018-08-21T23:32:48+0000","dateStarted":"2018-08-22T02:07:30+0000","dateFinished":"2018-08-22T02:07:34+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7036"},{"text":"%pyspark\nclient_orders \\\n    .withColumn('weekday', F.lit(udf_toWeekday(client_orders.timestamp))).alias(\"orderWeekdays\") \\\n    .filter(F.col('orderWeekdays.weekday') == 4).alias('order_4') \\\n    .groupBy('product_id').count().alias('grouped') \\\n    .orderBy(F.col('grouped.count'), ascending=False) \\\n    .show(10)","user":"anonymous","dateUpdated":"2018-08-22T02:07:37+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+-----+\n|product_id|count|\n+----------+-----+\n|B009G3T206|    3|\n|B006XNETVY|    3|\n|0815327609|    3|\n|B003MILGLE|    3|\n|B00F8JV0MK|    3|\n|B006NYOCK6|    3|\n|B00CL15PVA|    3|\n|B00QN67Q1G|    3|\n|0022749004|    3|\n|B0018U25HM|    2|\n+----------+-----+\nonly showing top 10 rows\n\n"}]},"apps":[],"jobName":"paragraph_1534894666026_-120958728","id":"20180821-233746_2128487204","dateCreated":"2018-08-21T23:37:46+0000","dateStarted":"2018-08-22T02:07:37+0000","dateFinished":"2018-08-22T02:07:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7037"},{"text":"%pyspark\ndef toMonthNumber(timestamp):\n    return int(datetime.strptime(timestamp, \"%Y-%m-%dT%H:%M:%S.%f\").strftime('%m'))\n    \nudf_toMonthNumber = F.udf(toMonthNumber, IntegerType())\n\nclient_orders \\\n    .withColumn('month', F.lit(udf_toMonthNumber(client_orders.timestamp))).alias(\"orderMonths\") \\\n    .filter(F.col('orderMonths.month') == 4).alias('month') \\\n    .groupBy(F.col('month.client_id')) \\\n    .agg(F.sum(\"month.total\").alias('gross_spending')) \\\n    .orderBy('gross_spending', ascending=False) \\\n    .show(10)","user":"anonymous","dateUpdated":"2018-08-22T02:07:43+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1534901424977_2077072565","id":"20180822-013024_1366631856","dateCreated":"2018-08-22T01:30:24+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7038","dateFinished":"2018-08-22T02:07:45+0000","dateStarted":"2018-08-22T02:07:43+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+------------------+\n|           client_id|    gross_spending|\n+--------------------+------------------+\n|1e0c8903-0182-489...|          65873.61|\n|e9ebeaa1-eebe-4ea...| 55183.18000000001|\n|1004c155-8d28-44a...|          52672.48|\n|7d13bf73-5a1e-4cf...| 51208.51000000001|\n|e11af8f8-ab9e-44b...|          51003.82|\n|0c1d2cbb-98d9-4c8...| 48166.67999999999|\n|2ae1e5f9-4469-464...| 47608.98999999999|\n|39836704-8c2e-423...|          47152.52|\n|a103761f-8d00-4d1...|          44778.05|\n|8a9563ee-7c26-418...|44095.409999999996|\n+--------------------+------------------+\nonly showing top 10 rows\n\n"}]}},{"text":"%pyspark\n\nclient_orders \\\n    .withColumn('month', F.lit(udf_toMonthNumber(client_orders.timestamp))).alias(\"orderMonths\") \\\n    .filter(F.col('orderMonths.month') == 4).alias('month') \\\n    .groupBy(F.col('month.client_id')) \\\n    .agg(F.count('month.product_id').alias('orders_count')) \\\n    .orderBy('orders_count', ascending=False) \\\n    .show(10)","user":"anonymous","dateUpdated":"2018-08-22T02:07:48+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1534902486315_-1989224713","id":"20180822-014806_606471248","dateCreated":"2018-08-22T01:48:06+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:7528","dateFinished":"2018-08-22T02:07:50+0000","dateStarted":"2018-08-22T02:07:48+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+------------+\n|           client_id|orders_count|\n+--------------------+------------+\n|9d8e54fc-fe94-49d...|          10|\n|acb8282a-ce47-49c...|          10|\n|4211c719-eaf0-44e...|          10|\n|baf479cf-ad31-43f...|          10|\n|0baed828-5fae-4c3...|          10|\n|3c961248-e54b-4a1...|          10|\n|cd4aa3c0-1155-4e3...|          10|\n|d10d0104-1c36-453...|          10|\n|9a5a6dfd-b7a7-4dd...|          10|\n|983114e2-16e4-454...|          10|\n+--------------------+------------+\nonly showing top 10 rows\n\n"}]}},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2018-08-22T02:01:16+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1534903276969_1999016155","id":"20180822-020116_1954593458","dateCreated":"2018-08-22T02:01:16+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:8258"}],"name":"assignment-3","id":"2DNHYN4HV","angularObjects":{"2DMNZA1Y4:shared_process":[],"2DQFGTKED:shared_process":[],"2DPMNM2DY:shared_process":[],"2DMJGGQKE:shared_process":[],"2DR7K7W1B:shared_process":[],"2DPRNPNRR:shared_process":[],"2DNXFTDZ7:shared_process":[],"2DNC64U5K:shared_process":[],"2DMQT22K6:shared_process":[],"2DPUTNHDX:shared_process":[],"2DN92ZSUZ:shared_process":[],"2DQUZA4AG:shared_process":[],"2DQHKH96Z:shared_process":[],"2DQGNECAM:shared_process":[],"2DP1AUCDG:shared_process":[],"2DN8ZD2QM:shared_process":[],"2DQYQXW7Q:shared_process":[],"2DPB3A9DU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}